(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{481:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"虚拟-dom-的原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟-dom-的原理"}},[s._v("#")]),s._v(" 虚拟 DOM 的原理")]),s._v(" "),t("h3",{attrs:{id:"是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[s._v("#")]),s._v(" 是什么")]),s._v(" "),t("p",[s._v("虚拟 DOM 就是虚拟节点，React 用 JS 对象来模拟 DOM 节点，然后将其渲染成真实的 DOM 节点。")]),s._v(" "),t("h3",{attrs:{id:"怎么做"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#怎么做"}},[s._v("#")]),s._v(" 怎么做")]),s._v(" "),t("h4",{attrs:{id:"第一步是模拟"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步是模拟"}},[s._v("#")]),s._v(" 第一步是模拟")]),s._v(" "),t("p",[s._v("用 JSX 语法写出来的 div 其实就是一个虚拟节点：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("span "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"red"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("span"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这代码会得到这样一个对象：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("tag")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("props")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("tag")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'span'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("props")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hi'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("能做到这一点是因为 JSX 语法会被转译为 createElement 函数调用，如下：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("React"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  React"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'span'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hi'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"第二步是将虚拟节点渲染为真实节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步是将虚拟节点渲染为真实节点"}},[s._v("#")]),s._v(" 第二步是将虚拟节点渲染为真实节点")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("render")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("vdom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果是字符串或者数字，创建一个文本节点")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" vdom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'string'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" vdom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'number'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createTextNode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vdom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" tag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" props"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" children "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" vdom\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建真实DOM")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" element "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置属性")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setProps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" props"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 遍历子节点，并获取创建真实DOM，插入到当前节点")]),s._v("\n  children\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("map")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("render"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("appendChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("element"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 虚拟 DOM 中缓存真实 DOM 节点")]),s._v("\n  vdom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" element\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回 DOM 节点")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" element\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" setProps "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 略")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" setProp "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 略")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 作者：Shenfq")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 链接：https://juejin.cn/post/6844903870229905422")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("注意，如果节点发生变化，并不会直接把新虚拟节点渲染到真实节点，而是先经过 diff 算法得到一个 patch 再更新到真实节点上。")]),s._v(" "),t("h3",{attrs:{id:"解决了什么问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决了什么问题"}},[s._v("#")]),s._v(" 解决了什么问题")]),s._v(" "),t("ul",[t("li",[s._v("DOM 操作性能问题。通过虚拟 DOM 和 diff 算法减少不必要的 DOM 操作，保证性能不太差")]),s._v(" "),t("li",[s._v("DOM 操作不方便问题。以前各种 DOM API 要记，现在只有 setState")])]),s._v(" "),t("h3",{attrs:{id:"优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),t("ul",[t("li",[s._v("为 React 带来了跨平台能力，因为虚拟节点除了渲染为真实节点，还可以渲染为其他东西。")]),s._v(" "),t("li",[s._v("让 DOM 操作的整体性能更好，能（通过 diff）减少不必要的 DOM 操作。")])]),s._v(" "),t("h3",{attrs:{id:"缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),t("ul",[t("li",[s._v("性能要求极高的地方，还是得用真实 DOM 操作（目前没遇到这种需求）")]),s._v(" "),t("li",[s._v("React 为虚拟 DOM 创造了合成事件，跟原生 DOM 事件不太一样，工作中要额外注意\n"),t("ul",[t("li",[s._v("所有 React 事件都绑定到根元素，自动实现事件委托")]),s._v(" "),t("li",[s._v("如果混用合成事件和原生 DOM 事件，有可能会出 bug")])])])]),s._v(" "),t("h2",{attrs:{id:"react-或-vue-的-dom-diff-算法是怎样的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-或-vue-的-dom-diff-算法是怎样的"}},[s._v("#")]),s._v(" React 或 Vue 的 DOM diff 算法是怎样的")]),s._v(" "),t("h3",{attrs:{id:"是什么-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#是什么-2"}},[s._v("#")]),s._v(" 是什么")]),s._v(" "),t("p",[s._v("DOM diff 就是对比两棵虚拟 DOM 树的算法。当组件变化时，会 render 出一个新的虚拟 DOM，diff 算法对比新旧虚拟 DOM 之后，得到一个 patch，然后 React 用 patch 来更新真实 DOM。")]),s._v(" "),t("h3",{attrs:{id:"怎么做-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#怎么做-2"}},[s._v("#")]),s._v(" 怎么做")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("首先对比两棵树的根节点")]),s._v(" "),t("ul",[t("li",[s._v("如果根节点的类型改变了，比如 div 变成了 p，那么直接认为整棵树都变了，不再对比子节点。此时直接删除对应的真实 DOM 树，创建新的真实 DOM 树。")])])]),s._v(" "),t("li",[t("p",[s._v("如果根节点的类型没变，就看看属性变了没有")]),s._v(" "),t("ul",[t("li",[s._v("如果没变，就保留对应的真实节点")]),s._v(" "),t("li",[s._v("如果变了，就只更新该节点的属性，不重新创建节点。\n"),t("ul",[t("li",[s._v("更新 style 时，如果多个 css 属性只有一个改变了，那么 React 只更新改变的。")])])])])]),s._v(" "),t("li",[t("p",[s._v("然后同时遍历两棵树的子节点，每个节点的对比过程同上。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("情况一")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<ul>\n  <li>A</li>\n  <li>B</li>\n</ul>\n\n<ul>\n  <li>A</li>\n  <li>B</li>\n  <li>C</li>\n</ul>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("React 依次对比 A-A、B-B、空-C，发现 C 是新增的，最终会创建真实 C 节点插入页面。")])]),s._v(" "),t("li",[t("p",[s._v("情况二")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<ul>\n  <li>B</li>\n  <li>C</li>\n</ul>\n\n<ul>\n  <li>A</li>\n  <li>B</li>\n  <li>C</li>\n</ul>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("React 对比 B-A，会删除 B 文本新建 A 文本；对比 C-B，会删除 C 文本，新建 B 文本；（注意，并不是边对比边删除新建，而是把操作汇总到 patch 里再进行 DOM 操作。）对比空-C，会新建 C 文本。")]),s._v(" "),t("p",[s._v("你会发现其实只需要创建 A 文本，保留 B 和 C 即可，为什么 React 做不到呢？")]),s._v(" "),t("p",[s._v("因为 React 需要你加 key 才能做到：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<ul>\n  <li key="b">B</li>\n  <li key="c">C</li>\n</ul>\n\n<ul>\n  <li key="a">A</li>\n  <li key="b">B</li>\n  <li key="c">C</li>\n</ul>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("React 先对比 key 发现 key 只新增了一个，于是保留 b 和 c，新建 a。")])])])])]),s._v(" "),t("h2",{attrs:{id:"react-dom-diff-和-vue-dom-diff-的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-dom-diff-和-vue-dom-diff-的区别"}},[s._v("#")]),s._v(" React DOM diff 和 Vue DOM diff 的区别")]),s._v(" "),t("p",[s._v("React DOM diff 和 Vue DOM diff 的区别：")]),s._v(" "),t("ul",[t("li",[s._v("React 是从左向右遍历对比，Vue 是双端交叉对比。")]),s._v(" "),t("li",[s._v("React 需要维护三个变量（有点扯），Vue 则需要维护四个变量。")]),s._v(" "),t("li",[s._v("Vue 整体效率比 React 更高，举例说明：假设有 N 个子节点，我们只是把最后子节点移到第一个，那么\n"),t("ul",[t("li",[s._v("React 需要进行借助 Map 进行 key 搜索找到匹配项，然后复用节点")]),s._v(" "),t("li",[s._v("Vue 会发现移动，直接复用节点")])])])]),s._v(" "),t("p",[s._v("Vue 的"),t("a",{attrs:{href:"https://canyuegongzi.github.io/web/vue/3.html#updatechildren",target:"_blank",rel:"noopener noreferrer"}},[s._v("双端交叉对比"),t("OutboundLink")],1),s._v("算法：")]),s._v(" "),t("p",[s._v("具体的 diff 分析")]),s._v(" "),t("p",[s._v("我们可以假设有旧的 Vnode 数组和新的 Vnode 数组这两个数组,而且有四个变量充当指针分别指到两个数组的头尾.")]),s._v(" "),t("p",[s._v("重复下面的对比过程，直到两个数组中任一数组的头指针超过尾指针，循环结束 :")]),s._v(" "),t("ul",[t("li",[s._v("头头对比: 对比两个数组的头部，如果找到，把新节点 patch 到旧节点，头指针后移")]),s._v(" "),t("li",[s._v("尾尾对比: 对比两个数组的尾部，如果找到，把新节点 patch 到旧节点，尾指针前移")]),s._v(" "),t("li",[s._v("旧尾新头对比: 交叉对比，旧尾新头，如果找到，把新节点 patch 到旧节点，旧尾指针前移，新头指针后移")]),s._v(" "),t("li",[s._v("旧头新尾对比: 交叉对比，旧头新尾，如果找到，把新节点 patch 到旧节点，新尾指针前移，旧头指针后移")]),s._v(" "),t("li",[s._v("利用 key 对比: 用新指针对应节点的 key 去旧数组寻找对应的节点,这里分三种情况,当没有对应的 key，那么创建新的节点，如果有 key 并且是相同的节点,把新节点 patch 到旧节点,如果有 key 但是不是相同的节点，则创建新节点")])]),s._v(" "),t("h2",{attrs:{id:"react-有哪些生命周期钩子函数-数据请求放在哪个钩子里"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-有哪些生命周期钩子函数-数据请求放在哪个钩子里"}},[s._v("#")]),s._v(" React 有哪些生命周期钩子函数？数据请求放在哪个钩子里？")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/",target:"_blank",rel:"noopener noreferrer"}},[s._v("React 生命周期"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("总得来说：")]),s._v(" "),t("ul",[t("li",[s._v("挂载时调用 constructor，更新时不调用")]),s._v(" "),t("li",[s._v("更新时调用 shouldComponentUpdate 和 getSnapshotBeforeUpdate，挂载时不调用")]),s._v(" "),t("li",[s._v("shouldComponentUpdate 在 render 前调用，getSnapshotBeforeUpdate 在 render 后调用")]),s._v(" "),t("li",[s._v("请求放在 componentDidMount 里")])]),s._v(" "),t("h2",{attrs:{id:"react-如何实现组件间通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-如何实现组件间通信"}},[s._v("#")]),s._v(" React 如何实现组件间通信")]),s._v(" "),t("ul",[t("li",[s._v("父子组件通信：props + 函数")]),s._v(" "),t("li",[s._v("爷孙组件通信：两层父子通信或者使用 Context.Provider 和 Context.Consumer/useContext")]),s._v(" "),t("li",[s._v("任意组件通信：其实就变成了状态管理了\n"),t("ul",[t("li",[s._v("Redux")]),s._v(" "),t("li",[s._v("Mobx")]),s._v(" "),t("li",[s._v("Recoil")])])])]),s._v(" "),t("h2",{attrs:{id:"你如何理解-redux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#你如何理解-redux"}},[s._v("#")]),s._v(" 你如何理解 Redux？")]),s._v(" "),t("blockquote",[t("p",[s._v("Redux 是一个可预测的状态管理库/状态容器。")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("把 Redux 的核心概念说一下：")]),s._v(" "),t("ul",[t("li",[s._v("State")]),s._v(" "),t("li",[s._v("Action = type + payload 荷载")]),s._v(" "),t("li",[s._v("Reducer")]),s._v(" "),t("li",[s._v("Dispatch 派发")]),s._v(" "),t("li",[s._v("Middleware")])])]),s._v(" "),t("li",[t("p",[s._v("ReactRedux 的核心概念说一下：")]),s._v(" "),t("ul",[t("li",[s._v("connect()(Component)")]),s._v(" "),t("li",[s._v("mapStateToProps")]),s._v(" "),t("li",[s._v("mapDispatchToProps")])])]),s._v(" "),t("li",[t("p",[s._v("说两个常见的中间件 redux-thunk redux-promise")])])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://chenwande.github.io/blog-website/blogs/React/redux.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("redux 实现"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"什么是高阶组件-hoc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是高阶组件-hoc"}},[s._v("#")]),s._v(" 什么是高阶组件 HOC？")]),s._v(" "),t("p",[s._v("参数是组件，返回值也是组件的函数。什么都能做，所以抽象问题就具体回答。")]),s._v(" "),t("p",[s._v("举例说明即可：")]),s._v(" "),t("ul",[t("li",[s._v("React.forwardRef")]),s._v(" "),t("li",[s._v("ReactRedux 的 connect")]),s._v(" "),t("li",[s._v("ReactRouter 的 withRouter")])])])}),[],!1,null,null,null);t.default=e.exports}}]);